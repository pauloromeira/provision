---
- hosts: all
  become: true
  pre_tasks:
    - import_tasks: tasks/update_package_cache.yml

  tasks:
    - name: hello world
      debug:
        msg: "hello world"

    - name: Create ~/.local/bin/
      become_user: paulo
      file:
        path: ~/.local/bin/
        state: directory

    - name: Copy provision to ~/.local/bin/
      become_user: paulo
      copy:
        src: provision.sh
        dest: ~/.local/bin/provision
        mode: 0775

    - name: Swap ctrl/caps and set right alt as compose key
      become_user: paulo
      dconf:
        key: "/org/gnome/desktop/input-sources/xkb-options"
        value: "['ctrl:swapcaps', 'compose:ralt']"

    - name: Install packages
      package:
        name:
          - git

    - name: Clone dotfiles to ~/.dotfiles/
      tags: dotfiles
      become_user: paulo
      git:
        repo: https://github.com/pauloromeira/dotfiles.git
        dest: ~/.dotfiles

    - name: Set dotfiles push to ssh url
      tags: dotfiles
      become_user: paulo
      git_config:
        repo: ~/.dotfiles
        scope: local
        name: remote.origin.pushurl
        value: git@github.com:pauloromeira/dotfiles.git
